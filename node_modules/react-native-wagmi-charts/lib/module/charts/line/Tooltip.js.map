{"version":3,"sources":["Tooltip.tsx"],"names":["React","Animated","useAnimatedStyle","useDerivedValue","useSharedValue","withTiming","LineChartDimensionsContext","CursorContext","LineChartPriceText","useLineChart","getYForX","useMemo","LineChartTooltip","displayName","children","xGutter","yGutter","cursorGutter","position","textProps","textStyle","at","props","width","height","parsedPath","pointWidth","useContext","type","currentX","currentY","isActive","x","elementWidth","elementHeight","handleLayout","useCallback","event","value","nativeEvent","layout","atXPosition","undefined","atYPosition","animatedCursorStyle","translateXOffset","isStatic","xOffset","translateYOffset","y","translateY","opacity","transform","translateX","padding","alignSelf","style"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport type { ViewProps } from 'react-native';\nimport Animated, {\n  useAnimatedStyle,\n  useDerivedValue,\n  useSharedValue,\n  withTiming,\n} from 'react-native-reanimated';\n\nimport { LineChartDimensionsContext } from './Chart';\nimport { CursorContext } from './Cursor';\nimport { LineChartPriceText, LineChartPriceTextProps } from './PriceText';\nimport { useLineChart } from './useLineChart';\nimport { getYForX } from 'react-native-redash';\nimport { useMemo } from 'react';\n\nexport type LineChartTooltipProps = Animated.AnimateProps<ViewProps> & {\n  children?: React.ReactNode;\n  xGutter?: number;\n  yGutter?: number;\n  cursorGutter?: number;\n  position?: 'top' | 'bottom';\n  textProps?: LineChartPriceTextProps;\n  textStyle?: LineChartPriceTextProps['style'];\n  /**\n   * When specified the tooltip is considered static, and will\n   * always be rendered at the given index, unless there is interaction\n   * with the chart (like interacting with a cursor).\n   *\n   * @default undefined\n   */\n  at?: number;\n};\n\nLineChartTooltip.displayName = 'LineChartTooltip';\n\nexport function LineChartTooltip({\n  children,\n  xGutter = 8,\n  yGutter = 8,\n  cursorGutter = 48,\n  position = 'top',\n  textProps,\n  textStyle,\n  at,\n  ...props\n}: LineChartTooltipProps) {\n  const { width, height, parsedPath, pointWidth } = React.useContext(\n    LineChartDimensionsContext\n  );\n  const { type } = React.useContext(CursorContext);\n  const { currentX, currentY, isActive } = useLineChart();\n\n  const x = useSharedValue(0);\n  const elementWidth = useSharedValue(0);\n  const elementHeight = useSharedValue(0);\n\n  const handleLayout = React.useCallback(\n    (event) => {\n      x.value = event.nativeEvent.layout.x;\n      elementWidth.value = event.nativeEvent.layout.width;\n      elementHeight.value = event.nativeEvent.layout.height;\n    },\n    [elementHeight, elementWidth, x]\n  );\n\n  // When the user set a `at` index, get the index's y & x positions\n  const atXPosition = useMemo(\n    () => (at == null ? undefined : pointWidth * at),\n    [at, pointWidth]\n  );\n  const atYPosition = useDerivedValue(() => {\n    return atXPosition == null\n      ? undefined\n      : getYForX(parsedPath, atXPosition) ?? 0;\n  }, [atXPosition]);\n\n  const animatedCursorStyle = useAnimatedStyle(() => {\n    let translateXOffset = elementWidth.value / 2;\n    // the tooltip is considered static when the user specified an `at` prop\n    const isStatic = atYPosition.value != null;\n\n    // Calculate X position:\n    const x = atXPosition ?? currentX.value;\n    if (x < elementWidth.value / 2 + xGutter) {\n      const xOffset = elementWidth.value / 2 + xGutter - x;\n      translateXOffset = translateXOffset - xOffset;\n    }\n    if (x > width - elementWidth.value / 2 - xGutter) {\n      const xOffset = x - (width - elementWidth.value / 2 - xGutter);\n      translateXOffset = translateXOffset + xOffset;\n    }\n\n    // Calculate Y position:\n    let translateYOffset = 0;\n    const y = atYPosition.value ?? currentY.value;\n    if (position === 'top') {\n      translateYOffset = elementHeight.value / 2 + cursorGutter;\n      if (y - translateYOffset < yGutter) {\n        translateYOffset = y - yGutter;\n      }\n    } else if (position === 'bottom') {\n      translateYOffset = -(elementHeight.value / 2) - cursorGutter / 2;\n      if (y - translateYOffset + elementHeight.value > height - yGutter) {\n        translateYOffset = y - (height - yGutter) + elementHeight.value;\n      }\n    }\n\n    // determine final translateY value\n    let translateY: number | undefined;\n    if (type === 'crosshair' || isStatic) {\n      translateY = y - translateYOffset;\n    } else {\n      if (position === 'top') {\n        translateY = yGutter;\n      } else {\n        translateY = height - elementHeight.value - yGutter;\n      }\n    }\n\n    let opacity = isActive.value ? 1 : 0;\n    if (isStatic) {\n      // Only show static when there is no active cursor\n      opacity = withTiming(isActive.value ? 0 : 1);\n    }\n\n    return {\n      transform: [\n        { translateX: x - translateXOffset },\n        {\n          translateY: translateY,\n        },\n      ],\n      opacity: opacity,\n    };\n  }, [\n    currentX,\n    currentY,\n    cursorGutter,\n    elementHeight,\n    elementWidth,\n    height,\n    isActive,\n    position,\n    type,\n    width,\n    xGutter,\n    yGutter,\n  ]);\n\n  return (\n    <Animated.View\n      onLayout={handleLayout}\n      {...props}\n      style={[\n        {\n          position: 'absolute',\n          padding: 4,\n          alignSelf: 'flex-start',\n        },\n        animatedCursorStyle,\n        props.style,\n      ]}\n    >\n      {children || (\n        <LineChartPriceText index={at} style={[textStyle]} {...textProps} />\n      )}\n    </Animated.View>\n  );\n}\n"]}